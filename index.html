<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Mini Cloud</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Segoe UI,Tahoma,Verdana,sans-serif;background:#f5f7fa;color:#333;
         display:flex;flex-direction:column;align-items:center;padding:20px;min-height:100vh}
    h1{font-size:2.5rem;margin-bottom:20px;color:#4a90e2;text-align:center}
    h3{margin:30px 0 10px;color:#555}
    form#uploadForm{display:flex;flex-direction:column;gap:10px;align-items:center;margin-bottom:20px}
    form#uploadForm input[type=file]{padding:10px;border:2px dashed #4a90e2;border-radius:8px;cursor:pointer}
    form#uploadForm button{padding:10px 20px;background:#4a90e2;color:#fff;border:none;border-radius:6px;
                           font-weight:bold;cursor:pointer;transition:background .3s}
    form#uploadForm button:hover{background:#3b7bc6}
    ul#fileList{list-style:none;width:100%;max-width:600px}
    ul#fileList li{background:#fff;padding:15px 20px;margin-bottom:12px;border-radius:10px;
                   display:flex;justify-content:space-between;align-items:center;
                   box-shadow:0 4px 10px rgba(0,0,0,0.05)}
    ul#fileList .meta{display:flex;flex-direction:column}
    .no-files{color:#666;padding:10px;text-align:center}
    @media(max-width:600px){
      ul#fileList li{flex-direction:column;align-items:flex-start;gap:10px}
      ul#fileList div{display:flex;gap:10px}
    }
  </style>
</head>
<body>
  <h1>Mini Cloud</h1>

  <form id="uploadForm" autocomplete="off">
    <input type="file" name="file" required>
    <button type="submit">Upload</button>
  </form>

  <h3>Files</h3>
  <ul id="fileList"></ul>

<script>
const API = '';

const uploadForm = document.getElementById('uploadForm');
const fileList = document.getElementById('fileList');

uploadForm.addEventListener('submit', async e => {
  e.preventDefault();
  const input = uploadForm.querySelector('input[type=file]');
  if (!input.files.length) return alert('Choose a file!');
  const fd = new FormData(); fd.append('file', input.files[0]);
  const btn = uploadForm.querySelector('button');
  const txt = btn.textContent;
  btn.disabled = true; btn.textContent = 'Uploading...';
  try {
    const r = await fetch(API+'/upload',{method:'POST',body:fd});
    if(!r.ok) throw new Error('Upload failed');
    input.value=''; await loadFiles();
  } catch(err){ alert(err.message); }
  finally{ btn.disabled=false; btn.textContent=txt; }
});

async function loadFiles(){
  try{
    const r=await fetch(API+'/files');
    if(!r.ok) throw new Error('Cannot load files');
    const files=await r.json();
    fileList.innerHTML='';
    if(!files.length) return fileList.innerHTML='<li class="no-files">No files yet</li>';
    files.forEach(f=>{
      const li=document.createElement('li');
      const meta=document.createElement('div'); meta.className='meta';
      meta.innerHTML=`<strong>${escape(f.filename||'')}</strong>
        <small>${f.contentType||'unknown'} · ${size(f.length)} · ${new Date(f.uploadDate).toLocaleString()}</small>`;
      const act=document.createElement('div');
      const a=document.createElement('a');
      a.textContent='View'; a.target='_blank'; a.href='/files/'+f._id;
      const d=document.createElement('button');
      d.textContent='Delete'; d.onclick=()=>delFile(f._id);
      act.append(a,d); li.append(meta,act); fileList.append(li);
    });
  }catch(e){fileList.innerHTML='<li class="no-files">Error loading files</li>';}
}

function size(b){if(b==0)return'0 B';const k=1024,s=['B','KB','MB','GB'];const i=Math.floor(Math.log(b)/Math.log(k));
 return (b/Math.pow(k,i)).toFixed(2)+' '+s[i];}

async function delFile(id){
  if(!confirm('Delete this file?'))return;
  await fetch('/files/'+id,{method:'DELETE'}); loadFiles();
}

function escape(s){return s.replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));}

loadFiles();
</script>
</body>
</html>
